# Одношаговые явные методы численного интегрирования

### Задача численного интегрирования

Найти численное значение функции $\mathbf{x}(t)$, пользуясь некоторой функцией ее производной:

$\mathbf{x}(t) \stackrel{f}{\rightarrow} \mathbf{x}(t+h)$

$\dot{\mathbf{x}} = \mathbf{f}(x)$

*Одношаговые методы* работают тем способом, что при вычислении значения функции в точке $\mathbf{x}(t+h)$ используют исключительно значение $\mathbf{x}(t)$ (то есть значение на предыдущем шаге) и некоторое количество вызовов функции $\mathbf{f}(x)$.

Такое семейство методов называется методами Рунге-Кутты.

### Явные методы Рунге-Кутты: общий принцип

Общий принцип таков: есть $s$ этапов, на каждом из которых происходит один вызов функции $\mathbf{f}$ .

$\mathbf{k}_1 = \mathbf{f}(\mathbf{x}(t))$

$\mathbf{k}_2 = \mathbf{f}(\mathbf{x}(t)+ha_{21}\mathbf{k}_1)$

$\mathbf{k}_3 = \mathbf{f}(\mathbf{x}(t) + ha_{31}\mathbf{k}_1 + ha_{32}\mathbf{k}_2)$

$...$

$\mathbf{k}_s = \mathbf{f}(\mathbf{x}(t) + h\sum_{i=1}^{s-1} a_{si}\mathbf{k}_i)$

Тогда окончательное значение функции $\mathbf{x}(t+h)$:

$\mathbf{x}(t+h) = \mathbf{x}(t)+h\sum_{i=1}^s b_i \mathbf{k}_i [+\varepsilon]$

Как правило, эта формула неточна, это численная аппроксимация с некоторой ошибой, которую обозначаем как $\varepsilon$.

### Таблицы Бутчера

Для упрощения записи конкретных методов семейства Рунге-Кутты существуют таблицы Бутчера – это таблицы коэффициентов:
$$
\begin{array}{|cccc}
    0     \\
    a_{21}     & 0 \\
     \vdots     & \vdots     &  \ddots   \\
     a_{s1}     & a_{s2}   &   \dots    & a_{ss} \\
    \hline
     b_1        & b_2       &  \dots     & b_s\\
  \end{array}
$$
В общепринятом виде таблица имеет еще один столбец слева, используемый для коэффициента при $h$ в аргументе $t$, то есть в неавтономных уравнениях, но в данном конспекте будут записаны таблицы без этого столбца.

Для понимания того, как записывается таблица, стоит внимательно посмотреть на общий принцип в предыдущем пункте.

На $i$-том этапе имеем $i-1$ коэффициентов, которые участвуют в линейной комбинации для вычисления $\mathbf{k}_i$. Также имеем члены $b_1, b_2, ... b_s$, которые используются при вычислении $\mathbf{x}(t+h)$. 

>  Нули на диагонали символизируют тот факт, что при обращении к $\mathbf{f}$ в линейной комбинации, которая подается ей как аргумент, не используем результат самой функции $\mathbf{f}$. Если бы было не так, то получилась бы система уравнений относительно $\mathbf{k}_i$. Именно так происходит в методах, которые называются *неявными*, более того, в этих методах значения выше диагонали также могут быть ненулевыми.

### Явные методы Рунге-Кутты: примеры

#### Метод Эйлера

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0 \\
    \hline
     1
  \end{array}
$$
Функция $f$ вызывается всего один раз. Метод имеет *первый порядок*.

Восстановим по таблице формулу для $\mathbf{x}(t+h)$. 

* Первая строка характеризует вычисление единственного коэффициента $\mathbf{k}_1$:

$\mathbf{k}_1=\mathbf{f}(\mathbf{x}(t))$

* Вторая строка содержит значение $b_1$ для окончательной формулы:

$\mathbf{x}(t+h) = \mathbf{x}(t) + hb_1\mathbf{k}_1=\mathbf{x}(t)+h\mathbf{f}(\mathbf{x}(t))+o(h)$

$o(h)$ - порядок ошибки.



#### Метод средней точки

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0 & \\
     1/2 & 0 \\
    \hline
     0   & 1
  \end{array}
$$
Функция $f$ вызывается два раза. Метод имеет *порядок 2*.

Восстановим по таблице формулу для $\mathbf{x}(t+h)$:

* Первая строка характеризует вычисление $\mathbf{k}_1$ (как можно заметить, во всех методах вычисление $\mathbf{k}_1$ одинаково)

$\mathbf{k}_1=\mathbf{f}(\mathbf{x}(t))$

* Вторая строка содержит коэффициенты для вычисления $\mathbf{k}_2$

$\mathbf{k}_2 = f\left(\mathbf{x}(t)+\dfrac{1}{2}h\mathbf{k}_1\right) = f\left(\mathbf{x}(t) + \dfrac{h}{2}h\mathbf{f}(\mathbf{x}(t))\right)$

* Третья строка содержит коэффициенты $b_1, b_2$ для окончательной формулы:

$\mathbf{x}(t+h)=\mathbf{x}(t)+h\mathbf{f}\left(\mathbf{x}(t) + \dfrac{h}{2}\mathbf{f}(\mathbf{x}(t))\right)+o(h^2)$

$o(h^2)$ - порядок ошибки.



#### Классический метод Рунге-Кутты 4-го порядка (РК4)

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0	&	&	&\\
     1/2& 0	&	&\\
     0  &1/2&0	&\\
     0  &0  & 1	& 0\\
    \hline
     1/6&1/3&1/3&1/6\\
  \end{array}
$$
Запишем уравнения для $\mathbf{k}_1, \mathbf{k}_2, \mathbf{k}_3, \mathbf{k}_4$:

$\mathbf{k}_1=\mathbf{f}(\mathbf{x}(t))$

$\mathbf{k}_2=f\left(\mathbf{x}(t)+\dfrac{h}{2}\mathbf{k}_1\right)$

$\mathbf{k}_3=f\left(\mathbf{x}(t)+\dfrac{h}{2}\mathbf{k}_2\right)$

$\mathbf{k}_4=f\left(\mathbf{x}(t)+h\mathbf{k}_3\right)$

Конечная формула для $\mathbf{x}(t+h)$:

$\mathbf{x}(t+h) = \mathbf{x}(t)+h\left(\dfrac{1}{6}\mathbf{k}_1+\dfrac{1}{3}\mathbf{k}_2+\dfrac{1}{3}\mathbf{k}_3+\dfrac{1}{6}\mathbf{k}_4\right) + o(h^4)$

### Многообразие явных методов Рунге-Кутты

Методов одинакового порядка может быть множество – можно варьировать значения коэффициентов в таблице Бутчера. Приведем несколько примеров.

#### Метод Хойна (порядок 2)

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0 & \\
     1 & 0 \\
    \hline
     1/2 & 1/2 \\
  \end{array}
$$

#### Метод Ралстона (порядок 2)

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0 & \\
     2/3 & 0 \\
    \hline
     1/4 & 3/4 \\
  \end{array}
$$
Отличается тем, что имеем минимальную теоретическую оценку ошибки среди методов 2-го порядка.

#### Метод Ралстона (порядок 3)

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0 & &\\
     1/2 & 0 &\\
     0 & 3/4 & 0\\
    \hline
     2/9 & 1/3 & 4/9 \\
  \end{array}
$$
Также имеем минимальную теоретическую оценку ошибки среди методов 3-го порядка.

Количество вызовов правых частей $f$ называется *рангом* метода, который, однако, не всегда совпадает с порядком.

#### Метод 3/8 (порядок 4)

Таблица Бутчера для метода:
$$
\begin{array}{|ccc}
     0	&	&	&\\
     1/3& 0	&	&\\
     -1/3  &1&0	&\\
     1  &-1  & 1& 0\\
    \hline
     1/8&3/8&3/8&1/8\\
  \end{array}
$$
Имеет лучшую теоретическую оценку ошибки, чем классический РК4, рассмотренный ранее.

Стоит отметить, что это в любом случае $o(h^4)$, но математически оценка коэффициентов для ошибки меньше.

#### Метод Ралстона (порядок 4)

Таблица Бутчера для метода:
$$
\begin{array}{|cccc}
     0 & \\
     2/5 & 0 \\
     \frac{-2889 + 1428 \sqrt{5}}{1024} & \frac{3875 - 1620 \sqrt{5}}{1024} & 0 \\
      \frac{-3365 + 2094 \sqrt{5}}{6040} & \frac{-975 - 3046\sqrt{5}}{2552} & \frac{467040 + 203968\sqrt{5}}{240845} & 0 \\
    \hline
     \frac{263 + 24 \sqrt{5}}{1812} & \frac{125 - 1000 \sqrt{5}}{3828} & \frac{1024(3346 + 1623 \sqrt{5})}{5924787} & \frac{30 - 4\sqrt{5}}{123}
  \end{array}
$$
Выглядит не очень презентабельно, но метод имеет минимальную теоретическую оценку ошибки среди методов 4-го порядка.

### Явные методы Рунге-Кутты высших порядков

Отметим несколько важных свойств:

* При порядке $n>4$ обязательно ранг $s>n$
* При $n>6$ обязательно $s>n+1$
* При $n>7$ обязательно $s>n+2$

#### Метод Рунге-Кутты-Фельберга 5-го порядка

Таблица Бутчера для метода:

$$
\begin{array}{|cccccc}
 \\
 \frac{1}{4} \\
 \frac{3}{32} & \frac{9}{32} \\
 \frac{1932}{2197} &  -\frac{7200}{2197} & \frac{7296}{2197} \\
 \frac{439}{216} & -8 & \frac{3680}{513} & -\frac{845}{4104} \\
 -\frac{8}{27} & 2 & -\frac{3544}{2565} & \frac{1859}{4104} & -\frac{11}{40} \\
\hline \frac{16}{135} & 0 & \frac{6656}{12825} & \frac{28561}{56430} & -\frac{9}{50} & \frac{2}{55} \\
\end{array}
$$

#### Метод Дормана-Принса 5-го порядка

Таблица Бутчера для метода:

$$
\begin{array}{|ccccc}
 \\
\frac{1}{5}\\
\frac{3}{40} & \frac{9}{40}  \\
\frac{44}{45} & -\frac{56}{15} & \frac{32}{9} \\
\frac{19372}{6561} & -\frac{25360}{2187} & \frac{64448}{6561} & -\frac{212}{729} \\
\frac{9017}{3168} & -\frac{355}{33} & \frac{46732}{5247} & -\frac{49}{176} & -\frac{5103}{18656} \\
\hline \frac{35}{384}  & 0 &  \frac{500}{1113} & \frac{125}{192} & -\frac{2187}{6784} & \frac{11}{84} \\
\end{array}
$$

Является более выгодным с точки зрения ошибки, чем метод РКФ5.

#### Другие явные методы высших порядков

Также известны методы:

* Метод Фельберга 8-го порядка
* Метод Дормана-Принса 8-го порядка (DOPRI8)
* Методы 10-го порядка (редко применяются)

На практике для порядков выше 8 используются неявные методы Рунге-Кутты или неявные многошаговые методы. Причина заключается в том, что при увеличении порядка явные методы сталкиваются с проблемами численной неустойчивости и численных артефактов.