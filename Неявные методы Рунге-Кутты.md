# Неявные методы Рунге-Кутты

Неявные методы Рунге-Кутты применяются для так называемых «жестких» систем ОДУ – системы, в которых применение явных методов Рунге-Кутты приводит к проблемам с устойчивостью.

### Общий вид неявных методов Рунге-Кутты

При вычислении правых частей $\mathbf{k}_i$ могут использоваться все $\mathbf{k}_j, j=1..s$:

<img src=".\sources\LETI10\ki.png" alt="ki" style="zoom:25%;" />

Значение вектора состояния на следующем шаге:

<img src=".\sources\LETI10\xtph.png" alt="xtph" style="zoom:25%;" />

Данное выражение является аппроксимацией с некоторой ошибкой $\varepsilon$.

В связи с тем, что $\mathbf{k}_i$ нельзя найти по явным формулам, для их нахождения рекомендуются методы нахождения корней уравнений: метод простой итерации, метод Ньютона.

Для краткой записи неявных методов Рунге-Кутты, как и для явных, используются таблицы Бутчера. Общий вид таблицы:

<img src=".\sources\LETI10\butcher.png" alt="butcher" style="zoom:25%;" />

### Неявный метод Эйлера

Неявный метод Эйлера также называют обратным, а явный - прямым.

Таблица Бутчера для метода:

<img src=".\sources\LETI10\11.png" alt="11" style="zoom:25%;" />

Формула для $\mathbf{x}(t+h)$:

<img src=".\sources\LETI10\euler.png" alt="euler" style="zoom:25%;" />

Несложно увидеть, что если рассмотреть уравнение как разложение в ряд Тейлора функции $\mathbf{x}$ в окрестности точки $t+h$, то значение в точке $t$ именно так и будет выражаться с ошибкой $O(h^2)$ или $o(h)$. Метод имеет порядок 1.

#### Пример

Рассмотрим динамическую систему с уравнением $f(x)=-kx$. Задача Коши данной системы имеет тривиальное математическое решение вида $x(t)=x_0 e^{-k/t}$. Отобразим картину траектории данной системы:

<img src=".\sources\LETI10\exp.png" alt="exp" style="zoom:50%;" />

По оси абсцисс – время $t$, по оси ординат – $x$. Здесь отображены кривые математического решения при разном значении $x_0$. 

Обратим внимание, что это уравнение имеет решение и в отрицательной области. Смены знака $x$ не должно происходить, но в численном методе это случается. 

Например, в явном методе Эйлера при выборе большого шага, например $h=2, x_0=1$. Производная при $t=0$ равна -1, соответственно,  после первого шага метод окажется в точке $(2, -1)$. В дальнейшем метод будет «прыгать» между разными по знаку и одинаковыми по значению $x$-ами и никогда не придет к $x=0$. На графике поведение метода при данном шаге изображено оранжевой ломаной.

Если выбрать шаг $h=3$, то метод после первого шага окажется в точке $(2, -2)$, и далее значения $x_i$ будут не только постоянно менять знак, но еще и становиться больше по модулю, то есть метод разойдется, траектория получится осциллирующей. Так и проявляется неустойчивость прямого метода Эйлера на этой задаче. Задача является жесткой и в ней стоит использовать неявный метод Эйлера. На графике поведение метода при данном шаге изображено зеленой ломаной.

В случае, если при том же $x_0=1$ брать шаг $h<2$, то явный метод сойдется:

<img src=".\sources\LETI10\xtph2.png" alt="xtph2" style="zoom:25%;" />

<img src=".\sources\LETI10\xt.png" alt="xt" style="zoom:25%;" />

Таким образом, метод сходится при $|1-kh|<1$.

Неявный метод Эйлера вне зависимости от выбора шага не уйдет в отрицательную область и на каждом шаге будет получаться значение меньше значению на предыдущем.

<img src=".\sources\LETI10\xtph3.png" alt="xtph3" style="zoom:25%;" />

<img src=".\sources\LETI10\xt2.png" alt="xt2" style="zoom:25%;" />

Метод сходится при $k>0, h>0$

На графике поведение метода при данном шаге изображено фиолетовой ломаной.

### Неявный метод средней точки

Таблица Бутчера для метода:

<img src=".\sources\LETI10\121.png" alt="121" style="zoom:25%;" />

Уравнение для коэффициента $\mathbf{k}_1$:

<img src=".\sources\LETI10\k1.png" alt="k1" style="zoom:25%;" />

Формула для $x(t+h)$:

<img src=".\sources\LETI10\xtph4.png" alt="xtph4" style="zoom:25%;" />

Разложим в ряд Тейлора выражение для $\mathbf{k}_1$:

<img src=".\sources\LETI10\midpoint1.png" alt="midpoint1" style="zoom:25%;" />

Сопоставим с разложением $\mathbf{x}(t+h)$ в ряд Тейлора в окрестности точки $t+h$:

<img src=".\sources\LETI10\midpoint2.png" alt="midpoint2" style="zoom:25%;" />

Это доказывает, что метод имеет порядок 2.

### Метод неявных трапеций

Таблица Бутчера для метода:

<img src=".\sources\LETI10\trap2.png" alt="trap2" style="zoom:25%;" />

Уравнения для коэффициентов:

<img src=".\sources\LETI10\k12.png" alt="k12" style="zoom:25%;" />

Формула для $x(t+h)$:

<img src=".\sources\LETI10\trap1.png" alt="trap1" style="zoom:25%;" />

Покажем, что метод имеет порядок 2, используя разложение в ряд Тейлора:

<img src=".\sources\LETI10\trap3.png" alt="trap3" style="zoom:25%;" />

Далее доказательство аналогично доказательству порядка неявного метода средней точки.

### Другие неявные одношаговые методы

Большая часть более интересных методов основана на аппроксимации функции правой части некоторым многочленом, построенным по значениям $f$ на некоторой сетке точек, и дальнейшем интегрировании этого многочлена с целью получения следующего вектора состояния системы. В зависимости от вида сетки точек более продвинутые методы распадаются на три вида:

* Методы Лобатто (порядки 2, 4, 6)
* Методы Радо (RADAU)
  * Метод Эверхарта до 15-го порядка (изначально создан для интегрирования систем небесной механики)
* Методы Гаусса-Лежандра
  * Метод Гаусса-Эверхарта (GAUSS15) до 15-го порядка

Применение того или иного метода сильно зависит от задачи и от того, как данный метод хорошо или плохо на данной задаче аппроксимирует решение, насколько хорошо сходится. Немаловажным является то, насколько требователен метод к вычислительным ресурсам. Неявные методы в целом намного более требовательны к ним, чем явные, так как на каждом шаге необходимо решать некоторую систему уравнений.

